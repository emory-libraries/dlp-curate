<% type_title = collection_type_label_for(collection: @collection) %>
<% provide :page_title, construct_page_title( t('.header', type_title: type_title)) %>
<% provide :page_header do %>
  <div class="as-button-div">
  <h1><span class="fa fa-edit" aria-hidden="true"></span> <%= t('.header', type_title: "User Collection") %> </h1>
  <button type="button" class="as-button btn btn-primary" data-toggle="modal" data-target="#asModal">Populate from ArchivesSpace</button>
  </div>
  <div id="asModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Populate from ArchivesSpace</h4>
      </div>
      <div class="modal-body">
        <p>Select an ArchivesSpace Repository.</p>
          <div class="form-group">
            <label for="sel1">Select list:</label>
            <select class="form-control" id="sel1">
            </select>
          </div>
        <div class="call-number-field">
          <label for="aspace-call-number">Call Number: (must be exact)</label>
          <input type="text" class="form-control" id="aspace-call-number">
      </div>
      <div class="modal-footer">
      <button type="button" class="btn btn-primary" id="aspace-loader"> Look for Resource in ArchivesSpace</button>
      
      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      
      <div id="aspace-result">
        <div class="modal-header">
          <h5 class="modal-title">Title:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
      </div>


    </div>

    </div>
  </div>
<% end %>

<div class="row">
  <div class="col-md-12">
    <%= render 'form' %>
  </div>
</div>

<script>

$("#aspace-result").hide();
console.log("checking the hide")

var repository_id;
var result_success;
var result_error;

$.ajax({
  url: '/aspace/repositories',
  type: 'GET',
  dataType: 'json',
  async: false,
  success: function(repositories) {
    jQuery.each( repositories, function(i, val) {
      var o = new Option(val.name, val.repository_id);
      /// jquerify the DOM object 'o' so we can use the html method
      $(o).html(val.name);
      $("#sel1").append(o);
      repository_id = val.repository_id;

    });
    console.log(repository_id);
  }
  });

  
  $("#aspace-loader").click(function (e) {
    
    let reposelector = document.querySelector('#sel1');
    let repo_value = reposelector.options[reposelector.selectedIndex].value;
      
      e.preventDefault();
      $.ajax({
          type: "GET",
          url: "/aspace/find_by_id?",
          async: false,
          dataType: 'json',
          data: {
              repository_id: repo_value,
              call_number: $("#aspace-call-number").val() // < note use of 'this' here

          },
          success: function (result) {
            console.log(result);
            console.log("yoyo");
            result_success = result;
            if (result.resource) {

              show_result();
            }
          },
          error: function (result) {
              alert('error');
              console.log(result);
              result_error = result;
          }
      });
  });
  function show_result() {
    $("#aspace-result").show();
    console.log("show result");
    console.dir(result_success);
    
  };
  
</script>