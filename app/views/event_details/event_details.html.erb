<%= tag.h1 t('.header') %>
<% # Preservation workflow data %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><%= t('hyrax.base.show.preservation_workflows') %></h3>
  </div>
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-6">
        <div><br>
          <!-- iterate through workflows -->
          <% @presenter.preservation_workflows.each do |pwf| %>
          <!-- display workflow type-->
          <b><%= pwf["Type"] %>:</b>
            <!-- display key value pairs only if workflow details exist -->
            <% unless pwf.values.count > 1 %>
              <div>No information supplied</div>
            <% else %>
              <% pwf.each do |key, value| %>
                <!-- display all key value pairs except type to match display requirements -->
                <div><%= "#{key}: #{value}" unless key == "Type" %></div>
              <% end %>
            <% end %>
            <br>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<% # Preservation event information %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><%= t('hyrax.base.show.preservation_events_work_level') %></h3>
  </div>
  <div class="container-fluid">
    <div class="row">
      <div><br>
        <% if @presenter.preservation_event.present? %>
          <table id="fs-preservation-event-table" class="table table-striped table-bordered">
            <thead>
              <th><%= t('.preservation_event_table.event') %></th>
              <th><%= t('.preservation_event_table.timestamp') %></th>
              <th><%= t('.preservation_event_table.outcome') %></th>
              <th><%= t('.preservation_event_table.detail') %></th>
              <th><%= t('.preservation_event_table.user') %></th>
              <th><%= t('.preservation_event_table.software') %></th>
            </thead>
            <tbody>
              <% @presenter.preservation_event.each do |event| %>
                <% parsed_event = JSON.parse(event) %>
                <tr>
                  <td><%= parsed_event['event_type'] %></td>
                  <td>
                      Start: <%= DateTime.parse(parsed_event['event_start']).strftime('%FT%T%:z') %><br>
                      End: <%= DateTime.parse(parsed_event['event_end']).strftime('%FT%T%:z') %>
                  </td>
                  <td><%= parsed_event['outcome'] %></td>
                  <td><%= parsed_event['event_details'] %></td>
                  <td><%= parsed_event['initiating_user'] %></td>
                  <td><%= parsed_event['software_version'] %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p class="no-preservation-events"><%= t('.no_events') %></p>
        <% end %>
      </div>
    </div>
  </div>
</div>