<%= render '/flash_msg' %>
<%= form_tag background_jobs_path, method: :post, multipart: true, class: "form-horizontal" do %>
  <h3>Background Jobs</h3>
  <table class="table table-striped">
    <tr>
      <th>Select Job</th>
      <th>Select Input File</th>
    </tr>
    <tr>
      <td>
        <%= radio_button_tag :jobs, 'cleanup', false, id: 'cleanup' %>
        <%= label :job_cleanup, 'FileSet Cleanup' %>
      </td>
      <td>N/A</td>
    </tr>
    <tr>
      <td>
        <%= radio_button_tag :jobs, 'reindex', false, id: 'reindex' %>
        <%= label :job_cleanup, 'Reindex Selected Files' %>
      </td>
      <td>
        <%= file_field_tag 'reindex_csv', class: 'files', :accept => 'text/csv' %>
      </td>
      
    </tr>
    <tr>
      <td>
        <%= radio_button_tag :jobs, 'preservation', false, id: 'preservation' %>
        <%= label :job_cleanup, 'Load Preservation Workflow Metadata' %>
      </td>
      <td>
        <%= file_field_tag 'preservation_csv', class: 'files', :accept => 'text/csv' %>
      </td>
    </tr>
  </table>
  <table class="table table-striped">
    <tr>
      <th>Preprocessors</th>
      <th>CSV File</th>
      <th>XML File</th>
      <th>Replacement Path</th>
      <th>Workflow</th>
      <th>Starting Page Number</th>
    </tr>
    <tr>
      <td>
        <%= radio_button_tag :jobs, 'dams_preprocessor', false, id: 'dams_preprocessor' %>
        <%= label :job_cleanup, 'DAMS Preprocessor' %>
      </td>
      <td>
        <%= file_field_tag 'dams_csv', class: 'files', :accept => 'text/csv' %>
      </td>
      <td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td>
    </tr>
    <tr>
      <td>
        <%= radio_button_tag :jobs, 'lang_preprocessor', false, id: 'lang_preprocessor' %>
        <%= label :job_cleanup, 'Langmuir Preprocessor' %>
      </td>
      <td>
        <%= file_field_tag 'lang_csv', class: 'files', :accept => 'text/csv' %>
      </td>
      <td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td>
    </tr>
    <tr>
      <td>
        <%= radio_button_tag :jobs, 'book_preprocessor', false, id: 'book_preprocessor' %>
        <%= label :job_cleanup, 'Book Preprocessor' %>
      </td>
      <td>
        <%= file_field_tag 'book_csv', class: 'files', :accept => 'text/csv' %>
      </td>
      <td>
        <%= file_field_tag 'book_xml', class: 'files', :accept => 'text/xml' %>
      </td>
      <td>
        <%= text_field_tag 'book_repl', nil, class: 'repl_text', placeholder: 'optional' %>
      </td>
      <td>
        <%= select_tag 'book_map', raw("<option>kirtas</option><option>limb</option>"), class: 'book_map_text', prompt: 'Please choose limb or kirtas' %>
      </td>
      <td>
        <%= number_field_tag 'book_start_num', nil, class: 'book_start_num', prompt: 'Start page of book' %>
      </td>
    </tr>
  </table>
  <button class="btn btn-primary" type="submit" value="Submit">Start Job</button>
<% end %>

<script type="text/javascript">
$(document).ready(function() {
    $("input[name='jobs']").on("click",function() {
      $('.files').each(function(i) {
         $(this).removeAttr('required');
      });
        var val = $(this).val()
        if(val !== 'cleanup'){
          $("input[name='" + val + "_csv']").prop('required',true);
        }
    }); 
});
</script>